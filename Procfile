ShareDiskMovieSearchBot/ â”œâ”€â”€ config.py â”‚ import os â”‚ from os import environ â”‚ import re â”‚
â”‚ # Utility functions â”‚ id_pattern = re.compile(r'^-?\d+$') # Fixed to handle negative integers for channel IDs â”‚
â”‚ def is_enabled(value, default): â”‚ if value.lower() in ["true", "yes", "1", "enable", "y"]: â”‚ return True â”‚ elif value.lower() in ["false", "no", "0", "disable", "n"]: â”‚ return False â”‚ else: â”‚ return default â”‚
â”‚ # Bot Information (with validation) â”‚ API_ID = environ.get('API_ID', '26954495') â”‚ API_HASH = environ.get('API_HASH', '2061c55207cfee4f106ff0dc331fe3d9') â”‚ BOT_TOKEN = environ.get('BOT_TOKEN', "") â”‚ SESSION = environ.get('SESSION', 'Deendayal_search') â”‚
â”‚ # Validate required environment variables â”‚ if not API_ID or not API_HASH or not BOT_TOKEN: â”‚ raise ValueError("API_ID, API_HASH, and BOT_TOKEN must be set in the environment variables.") â”‚
â”‚ # Bot Settings â”‚ CACHE_TIME = int(environ.get('CACHE_TIME', 300)) â”‚ USE_CAPTION_FILTER = bool(environ.get('USE_CAPTION_FILTER', True)) â”‚
â”‚ # Admin, Channels & Users â”‚ ADMINS = [int(admin) if id_pattern.search(admin) else admin for admin in environ.get('ADMINS', '6285713858 7045947967').split()] â”‚ DEENDAYAL_MOVIE_UPDATE_CHANNEL = int(environ.get('DEENDAYAL_MOVIE_UPDATE_CHANNEL', '-1002608186529')) â”‚ AUTH_CHANNEL = [int(fch) if id_pattern.search(fch) else fch for fch in environ.get('AUTH_CHANNEL', '-100').split()] â”‚
â”‚ # Channel & Group Links â”‚ GRP_LNK = environ.get('GRP_LNK', 'https://t.me/SDMOVIESPOINTEe') â”‚ CHNL_LNK = environ.get('CHNL_LNK', 'https://t.me/pikashow_7') â”‚ OWNER_LNK = environ.get('OWNER_LNK', 'https://t.me/Keshavraj_77') # Updated to @Keshavraj_77 â”‚ DEENDAYAL_MOVIE_UPDATE_CHANNEL_LNK = environ.get('DEENDAYAL_MOVIE_UPDATE_CHANNEL_LNK', 'https://t.me/pikashow_7') â”‚
â”‚ # MongoDB Configuration â”‚ DATABASE_URI = environ.get('DATABASE_URI', "mongodb+srv://nr385708:bs6GdimYoAzmHbRF@cluster0.xtpwl.mongodb.net/?retryWrites=true&w=majority&appName=Cluster0") â”‚ DATABASE_NAME = environ.get('DATABASE_NAME', "cluster") â”‚ COLLECTION_NAME = environ.get('COLLECTION_NAME', 'Deendayal_files') â”‚
â”‚ # Validate MongoDB URI â”‚ if not DATABASE_URI: â”‚ raise ValueError("DATABASE_URI must be set in the environment variables.") â”‚
â”‚ # Miscellaneous â”‚ CUSTOM_FILE_CAPTION = environ.get("CUSTOM_FILE_CAPTION", "ğŸ“½ï¸ {file_name}\n\nğŸ’¾ Size: {file_size}") â”‚
â”œâ”€â”€ database.py â”‚ from pymongo import MongoClient â”‚ from config import DATABASE_URI, DATABASE_NAME, COLLECTION_NAME â”‚
â”‚ # Initialize MongoDB client â”‚ client = MongoClient(DATABASE_URI, serverSelectionTimeoutMS=5000) â”‚ db = client[DATABASE_NAME] â”‚ collection = db[COLLECTION_NAME] â”‚
â”‚ def find_movie(query): â”‚ """Search for a movie in the database by title.""" â”‚ try: â”‚ return collection.find_one({"title": {"$regex": query, "$options": "i"}}) â”‚ except Exception as e: â”‚ print(f"Error finding movie: {e}") â”‚ return None â”‚
â”‚ def insert_movie(movie_data): â”‚ """Insert a movie into the database (for setup purposes).""" â”‚ try: â”‚ collection.insert_one(movie_data) â”‚ print(f"Inserted movie: {movie_data['title']}") â”‚ except Exception as e: â”‚ print(f"Error inserting movie: {e}") â”‚
â”‚ def close_connection(): â”‚ """Close the MongoDB connection.""" â”‚ client.close() â”‚ print("MongoDB connection closed.") â”‚
â”œâ”€â”€ handlers/start_handler.py â”‚ from pyrogram import filters â”‚ from pyrogram.types import InlineKeyboardMarkup, InlineKeyboardButton â”‚ from config import CHNL_LNK, GRP_LNK â”‚
â”‚ def register_start_handler(app): â”‚ @app.on_message(filters.command("start")) â”‚ async def start(client, message): â”‚ welcome_text = ( â”‚ "HEY! OWNER ğŸ˜,\n\n" â”‚ "ME! SHAREDISK MOVIE SEARCH BOT ğŸ¤–\n\n" â”‚ "I CAN SEARCH MOVIES FOR YOU. ğŸ”\n\n" â”‚ "MADE WITH â¤ï¸ BY @Keshavraj_77" â”‚ ) â”‚ buttons = InlineKeyboardMarkup( â”‚ [ â”‚ [ â”‚ InlineKeyboardButton("OUR CHANNEL", url=CHNL_LNK), â”‚ InlineKeyboardButton("OUR GROUP", url=GRP_LNK), â”‚ ], â”‚ [ â”‚ InlineKeyboardButton("About", callback_data="about"), â”‚ InlineKeyboardButton("Help", callback_data="help"), â”‚ ] â”‚ ] â”‚ ) â”‚ await message.reply_text(welcome_text, reply_markup=buttons) â”‚
â”œâ”€â”€ handlers/search_handler.py â”‚ from pyrogram import filters â”‚ from pyrogram.types import InlineKeyboardMarkup, InlineKeyboardButton â”‚ from pyrogram.errors import UserNotParticipant â”‚ from config import DEENDAYAL_MOVIE_UPDATE_CHANNEL, DEENDAYAL_MOVIE_UPDATE_CHANNEL_LNK â”‚
â”‚ def register_search_handler(app): â”‚ @app.on_message(filters.text & ~filters.command(["start"])) â”‚ async def search_movie(client, message): â”‚ user_id = message.from_user.id â”‚ movie_query = message.text.strip() â”‚
â”‚ # Check if the user has joined the update channel â”‚ try: â”‚ await client.get_chat_member(DEENDAYAL_MOVIE_UPDATE_CHANNEL, user_id) â”‚ except UserNotParticipant: â”‚ # Prompt user to join the update channel â”‚ join_text = ( â”‚ "HEY! OWNER ğŸ˜Š\n\n" â”‚ "YOU HAVE TO JOIN OUR UPDATES CHANNEL TO USE ME âœ…\n\n" â”‚ "CLICK BELLOW BUTTON TO JOIN NOW. ğŸ‘‡" â”‚ ) â”‚ buttons = InlineKeyboardMarkup( â”‚ [ â”‚ [ â”‚ InlineKeyboardButton("ğŸ¿ UPDATES CHANNEL ğŸ¿", url=DEENDAYAL_MOVIE_UPDATE_CHANNEL_LNK) â”‚ ] â”‚ ] â”‚ ) â”‚ await message.reply_text(join_text, reply_markup=buttons) â”‚ return â”‚ except Exception as e: â”‚ # Handle other potential errors (e.g., bot not being an admin in the channel) â”‚ await message.reply_text(f"Error checking channel membership: {str(e)}\nPlease contact @Keshavraj_77 for assistance.") â”‚ return â”‚
â”‚ # If the user has joined, provide a clickable link to search for the movie â”‚ search_text = ( â”‚ f"CLICK HERE ğŸ‘‡ FOR "{movie_query}"" â”‚ ) â”‚ buttons = InlineKeyboardMarkup( â”‚ [ â”‚ [ â”‚ InlineKeyboardButton(f"ğŸ¿ {movie_query.upper()} ğŸ¿\nCLICK ME FOR RESULTS", callback_data=f"search:{movie_query}"), â”‚ ], â”‚ [ â”‚ InlineKeyboardButton("? HOW TO OPEN LINK ?", callback_data="how_to_open"), â”‚ InlineKeyboardButton("ğŸ‘ˆ SEARCH HERE ğŸ‘ˆ", callback_data="search_here"), â”‚ ] â”‚ ] â”‚ ) â”‚ await message.reply_text(search_text, reply_markup=buttons) â”‚
â”œâ”€â”€ handlers/callback_handler.py â”‚ from pyrogram import filters â”‚ from pyrogram.types import InlineKeyboardMarkup, InlineKeyboardButton â”‚ from database import find_movie â”‚
â”‚ def register_callback_handler(app): â”‚ @app.on_callback_query() â”‚ async def callback_query(client, callback_query): â”‚ data = callback_query.data â”‚
â”‚ if data.startswith("search:"): â”‚ movie_query = data.split(":", 1)[1] â”‚ movie = find_movie(movie_query) â”‚
â”‚ if movie: â”‚ # Format the movie details with download links â”‚ result_text = ( â”‚ f"{movie['title'].upper()} ({movie['year']}) ğŸ¿\n\n" â”‚ f"ORIGINAL {movie['language'].upper()} DUBBED ğŸ™ï¸\n\n" â”‚ f"ORIGINAL PRINT ğŸ“¼\n\n" â”‚ f"480P - {movie['links']['480p']}\n\n" â”‚ f"720P - {movie['links']['720p']}\n\n" â”‚ f"1080P - {movie['links']['1080p']}\n\n" â”‚ f"UPLOADED BY @DUKAN_KA_SAMAN" â”‚ ) â”‚ buttons = InlineKeyboardMarkup( â”‚ [ â”‚ [ â”‚ InlineKeyboardButton("WRONG LAYOUT?", callback_data="wrong_layout") â”‚ ] â”‚ ] â”‚ ) â”‚ await callback_query.message.edit_text(result_text, reply_markup=buttons) â”‚ else: â”‚ await callback_query.message.edit_text("Movie not found in the database. Please try a different title or contact @Keshavraj_77 for assistance.") â”‚
â”‚ elif data == "how_to_open": â”‚ await callback_query.message.edit_text("To open the link, simply click on the resolution link (e.g., 480P, 720P, 1080P) to download or stream the movie.") â”‚ elif data == "search_here": â”‚ await callback_query.message.edit_text("Please type the movie name again to search.") â”‚ elif data == "wrong_layout": â”‚ await callback_query.message.edit_text("If the layout is wrong, please contact the bot owner @Keshavraj_77 for assistance.") â”‚
â”œâ”€â”€ main.py â”‚ from pyrogram import Client â”‚ from config import API_ID, API_HASH, BOT_TOKEN, SESSION â”‚ from handlers.start_handler import register_start_handler â”‚ from handlers.search_handler import register_search_handler â”‚ from handlers.callback_handler import register_callback_handler â”‚ from database import insert_movie, close_connection â”‚
â”‚ # Initialize the bot â”‚ app = Client( â”‚ SESSION, â”‚ api_id=API_ID, â”‚ api_hash=API_HASH, â”‚ bot_token=BOT_TOKEN, â”‚ workers=2, â”‚ connection_timeout=30 â”‚ ) â”‚
â”‚ # Register handlers â”‚ register_start_handler(app) â”‚ register_search_handler(app) â”‚ register_callback_handler(app) â”‚
â”‚ # Insert sample movies into the database (for testing) â”‚ sample_movies = [ â”‚ { â”‚ "title": "RRR", â”‚ "year": 2022, â”‚ "language": "Hindi", â”‚ "links": { â”‚ "480p": "https://gplinks.co/y8UZi", â”‚ "720p": "https://gplinks.co/SB45BU", â”‚ "1080p": "https://gplinks.co/A3H2" â”‚ } â”‚ }, â”‚ { â”‚ "title": "Come Play", â”‚ "year": 2020, â”‚ "language": "English", â”‚ "links": { â”‚ "480p": "https://example.com/comeplay_480p", â”‚ "720p": "https://example.com/comeplay_720p", â”‚ "1080p": "https://example.com/comeplay_1080p" â”‚ } â”‚ } â”‚ ] â”‚
â”‚ for movie in sample_movies: â”‚ insert_movie(movie) â”‚
â”‚ # Start the bot â”‚ if name == "main": â”‚ try: â”‚ print("Bot is running...") â”‚ app.run() â”‚ finally: â”‚ # Close the MongoDB connection when the bot stops â”‚ close_connection() â”‚
â”œâ”€â”€ requirements.txt â”‚ pyrogram==2.0.106 â”‚ pymongo==4.6.1 â”‚
â”œâ”€â”€ README.md â”‚ # ShareDisk Movie Search Bot â”‚
â”‚ A Telegram bot that allows users to search for movies and provides download links in various resolutions. Built using Pyrogram and MongoDB. â”‚
â”‚ ## Features â”‚ - Welcome message with channel and group links. â”‚ - Force-sub to an updates channel before searching. â”‚ - Search for movies and get download links in 480p, 720p, and 1080p. â”‚
â”‚ ## Setup â”‚ 1. Clone the repository: â”‚ â”‚ git clone https://github.com/yourusername/ShareDiskMovieSearchBot.git â”‚ cd ShareDiskMovieSearchBot â”‚ â”‚ 2. Install dependencies: â”‚ â”‚ pip install -r requirements.txt â”‚ â”‚ 3. Set environment variables in config.py or via your environment: â”‚ - API_ID: Your Telegram API ID. â”‚ - API_HASH: Your Telegram API Hash. â”‚ - BOT_TOKEN: Your Telegram Bot Token. â”‚ - DATABASE_URI: Your MongoDB URI. â”‚ 4. Run the bot: â”‚ â”‚ python main.py â”‚ â”‚
â”‚ ## Usage â”‚ - Start the bot with /start. â”‚ - Search for a movie by typing its name (e.g., "RRR"). â”‚ - Join the updates channel if prompted. â”‚ - Click the search result button to get download links. â”‚
â””â”€â”€ Procfile worker: python3 main.py
